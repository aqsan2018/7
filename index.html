<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>Kiss Filler</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

<style>
  html,body { height:100%; margin:0; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial; }
  body {
    background:#fce7f3;
    display:flex; align-items:center; justify-content:center;
    min-height:100vh; overflow:hidden; touch-action:none;
  }
  #container { position:relative; width:100vw; height:100vh; overflow:hidden; }
  #instructions {
    position:absolute; top:35%; left:50%; transform:translate(-50%,-50%);
    font-size:2rem; color:#db2777; text-align:center; font-weight:700; z-index:400;
    pointer-events:none; user-select:none;
  }

  #final-message {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    z-index:600; pointer-events:none; opacity:0; transition:opacity .4s ease;
    background:rgba(255,255,255,.6); padding:1.5rem 2rem; border-radius:12px; backdrop-filter:blur(4px);
    display:flex; flex-direction:column; align-items:center; max-width:90%; text-align:center;
  }
  #message-text {
    font-size:1.8rem; color:#be185d; font-weight:700;
    user-select:none; margin-bottom:1.5rem; line-height:1.4;
  }
  #play-again-button {
    pointer-events:all;
    background-color:#db2777;
    color:white; font-size:1.2rem; font-weight:700;
    padding:0.75rem 1.5rem; border-radius:8px; border:none;
    cursor:pointer; transition:background-color 0.3s ease;
  }
  #play-again-button:hover { background-color:#be185d; }
  #click-counter { position:absolute; top:18px; left:18px; font-size:1.2rem; color:#9d174d; z-index:400; user-select:none; }
  canvas { position:absolute; top:0; left:0; z-index:1; pointer-events:none; }
</style>
</head>
<body>
  <div id="container">
    <div id="instructions">I'm feeling a little un-loved.<br>Click to fill me up!</div>
    <div id="final-message">
      <p id="message-text"></p>
      <button id="play-again-button">Again</button>
    </div>
    <div id="click-counter">Kisses: 0</div>
  </div>

  <audio id="reveal-sound" src="reveal_ding.mp3" preload="auto"></audio>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const { Engine, Render, Runner, World, Bodies, Events, Composite } = Matter;

  const container = document.getElementById('container');
  const instructions = document.getElementById('instructions');
  const finalMessage = document.getElementById('final-message');
  const messageText = document.getElementById('message-text');
  const playAgainButton = document.getElementById('play-again-button');
  const clickCounter = document.getElementById('click-counter');
  const revealSound = document.getElementById('reveal-sound');

  const worldWidth = window.innerWidth;
  const worldHeight = window.innerHeight;
  const emojiPx = 56;
  const physicsRadius = emojiPx / 2;
  const clicksToReveal = 100;
  const emojiList = ['💋','❤️','😘'];

  const messages = [
    "1. Every kiss you send feels like sunlight warming me from the inside out. I could live in this feeling forever.",
    "2. You make my heart do that happy little dance it only does for you. Keep those kisses coming.",
    "3. If affection had a soundtrack, yours would be my favorite song on repeat. Don't ever stop.",
    "4. Each kiss feels like a promise wrapped in warmth. I never get tired of unwrapping it.",
    "5. Somehow, you turn simple moments into something that glows. This one shines brightest.",
    "6. You just made my entire day softer, warmer, and infinitely better. How do you do that?",
    "7. That one felt like a secret only my heart understood — and it’s not telling.",
    "8. You have no idea how addictive your kindness is. I'm officially hooked.",
    "9. If happiness had a texture, it’d feel exactly like this kiss.",
    "10. You don’t just make me smile; you make my soul stretch out and sigh.",
    "11. I swear I could bottle this feeling and live off it for years.",
    "12. Each little kiss lands like a spark — quiet, but impossible to ignore.",
    "13. I’m convinced you’ve mastered the ancient art of making hearts melt.",
    "14. That one didn’t just hit — it lingered, like something that refuses to fade.",
    "15. You know that flutter in your chest? Yeah. You caused it. Again.",
    "16. This isn’t just cute anymore. It’s dangerously close to perfect.",
    "17. Somehow your virtual kisses feel like real ones. Explain yourself.",
    "18. You just gave my serotonin a standing ovation.",
    "19. Every new one feels like a continuation of a story I never want to end.",
    "20. You’ve officially made my screen blush.",
    "21. That kiss was so sweet I think my phone just got cavities.",
    "22. You’re sending affection like it’s your full-time job — and you’re excellent at it.",
    "23. The world feels a bit quieter when you do that. Don’t stop.",
    "24. That one didn’t just land. It stayed.",
    "25. Somewhere, the universe just took a screenshot of this moment.",
    "26. You’ve got me smiling like a secret I can’t keep.",
    "27. There’s something healing about your energy — even through pixels.",
    "28. That kiss felt like a soft exhale I didn’t know I needed.",
    "29. I’d say ‘enough kisses,’ but we both know that’s impossible.",
    "30. Each tap, each kiss — tiny proof that connection is real.",
    "31. I can’t decide what’s better — your timing or your tenderness.",
    "32. Somehow, affection through a screen shouldn’t feel this real. Yet, here we are.",
    "33. Every click adds to a story that’s entirely ours.",
    "34. That one had extra charm. I can tell you’re showing off now.",
    "35. Okay, now my heart is just doing laps. Thanks for that.",
    "36. You’ve turned pixels into feelings. That’s some kind of magic.",
    "37. Keep this up and I might start believing in fairy tales again.",
    "38. You just made everything feel softer — again.",
    "39. That kiss was less a click and more a confession.",
    "40. You’re easily my favorite notification.",
    "41. Somehow, you’ve made affection feel new again.",
    "42. That one deserves applause — or maybe a hug.",
    "43. I think my heart just learned your rhythm.",
    "44. You’re dangerously good at this.",
    "45. If kisses were language, yours would be poetry.",
    "46. I didn’t expect that one to hit this hard.",
    "47. You’ve got a way of making the world pause.",
    "48. That felt like a promise and a memory all at once.",
    "49. My heart’s officially out of office. You did this.",
    "50. You ended this round, but you’ve started something bigger — and I love it."
  ];

  const engine = Engine.create({ gravity:{ y:0.45 } });
  const world = engine.world;
  const render = Render.create({
    element:container, engine, options:{ width:worldWidth, height:worldHeight, wireframes:false, background:'transparent' }
  });
  Render.run(render);
  Runner.run(Runner.create(), engine);
  const wallOpts={isStatic:true,render:{visible:false}};
  World.add(world,[
    Bodies.rectangle(worldWidth/2,worldHeight+40,worldWidth+200,80,wallOpts),
    Bodies.rectangle(-40,worldHeight/2,80,worldHeight,wallOpts),
    Bodies.rectangle(worldWidth+40,worldHeight/2,80,worldHeight,wallOpts)
  ]);

  const imageCache=new Map();
  function emojiToCodePoint(e){return Array.from(e).map(c=>c.codePointAt(0).toString(16)).join('-');}
  function loadEmojiPNG(e){
    if(imageCache.has(e)) return;
    const code=emojiToCodePoint(e);
    const url=`https://twemoji.maxcdn.com/v/latest/72x72/${code}.png`;
    const img=new Image(); img.crossOrigin='anonymous';
    img.onload=()=>imageCache.set(e,img);
    img.onerror=()=>imageCache.set(e,null);
    img.src=url;
  }
  emojiList.forEach(loadEmojiPNG);
  const bodyEmoji=new Map();

  Events.on(render,'afterRender',()=>{
    const ctx=render.context;
    bodyEmoji.forEach((emoji,id)=>{
      const b=world.bodies.find(bb=>bb.id===id);
      if(!b) return;
      ctx.save(); ctx.translate(b.position.x,b.position.y); ctx.rotate(b.angle);
      const img=imageCache.get(emoji);
      if(img){ ctx.drawImage(img,-emojiPx/2,-emojiPx/2,emojiPx,emojiPx); }
      else { ctx.font=`${emojiPx}px "Segoe UI Emoji","Apple Color Emoji",sans-serif`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(emoji,0,0); }
      ctx.restore();
    });
  });

  const STORAGE_PREFIX='kiss_seq_';
  let ownerKey=null;
  function hashString(s){let h=5381;for(let i=0;i<s.length;i++)h=((h<<5)+h)+s.charCodeAt(i);return String(h>>>0);}
  function initOwnerKey(){
    return new Promise(res=>{
      fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>{
        const ip=d?.ip||'local'; ownerKey=STORAGE_PREFIX+hashString(ip); res(ownerKey);
      }).catch(()=>{ownerKey=STORAGE_PREFIX+'local';res(ownerKey);});
    });
  }
  function loadIndex(){try{return parseInt(localStorage.getItem(ownerKey+'_i'))||0;}catch{return 0;}}
  function saveIndex(i){try{localStorage.setItem(ownerKey+'_i',String(i));}catch{}}
  function getNextMessage(){
    let i=loadIndex();
    const msg=messages[i];
    i=(i+1)%messages.length;
    saveIndex(i);
    return msg;
  }
  initOwnerKey();

  const kissSounds = [
    new Audio('kiss1.mp3'),
    new Audio('kiss2.mp3')
  ];
  let kissIndex = 0;
  let clickCount=0, messageRevealed=false;

  function addEmoji(x,y){
    if(messageRevealed) return;
    clickCount++;
    clickCounter.textContent=`Kisses: ${clickCount}`;

    // --- Play kiss sound instantly even if spammed ---
    try {
      const src = kissSounds[kissIndex].src;
      const clone = new Audio(src);
      clone.volume = 0.9;
      clone.play().catch(()=>{});
    } catch(e){}
    kissIndex = (kissIndex + 1) % kissSounds.length;

    const emoji = emojiList[Math.floor(Math.random()*emojiList.length)];
    const body = Bodies.circle(x,y,physicsRadius,{restitution:0.6,friction:0.2,density:0.005});
    World.add(world,body);
    bodyEmoji.set(body.id,emoji);

    if(clickCount===1){ instructions.style.opacity='0'; }

    if(clickCount>=clicksToReveal && !messageRevealed){
      messageRevealed=true;
      const text=getNextMessage();
      messageText.textContent=text;
      finalMessage.style.opacity='1';
      revealSound.currentTime=0; revealSound.play().catch(()=>{});
    }
  }

  function resetGame(){
    finalMessage.style.opacity='0';
    Composite.clear(world,false);
    bodyEmoji.clear();
    World.add(world,[
      Bodies.rectangle(worldWidth/2,worldHeight+40,worldWidth+200,80,wallOpts),
      Bodies.rectangle(-40,worldHeight/2,80,worldHeight,wallOpts),
      Bodies.rectangle(worldWidth+40,worldHeight/2,80,worldHeight,wallOpts)
    ]);
    clickCount=0; messageRevealed=false;
    clickCounter.textContent='Kisses: 0';
    instructions.style.opacity='1';
  }

  container.addEventListener('mousedown',e=>addEmoji(e.clientX,e.clientY));
  container.addEventListener('touchstart',e=>{e.preventDefault();const t=e.touches[0];addEmoji(t.clientX,t.clientY);},{passive:false});
  playAgainButton.addEventListener('click',resetGame);
  window.addEventListener('resize',()=>location.reload());
});
</script>
</body>
</html>
